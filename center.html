<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plantasia App v60 – All Presets Restored</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');
    :root { --bg: #000; --fg: #fff; --font: 'Roboto Mono', monospace; --accent: #00ff00; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font); background: var(--bg); color: var(--fg); overflow: hidden; }
    h1 { text-align: center; margin: 1rem 0; font-size: 1.5rem; }
    #uiPanel { position: absolute; top: 1rem; right: 1rem; display: flex; gap: 0.5rem; z-index: 3; }
    button, select, input[type="range"] {
      background: transparent; color: var(--fg); border: 1px solid var(--fg);
      padding: 0.5rem 1rem; font-size: 0.9rem; text-transform: uppercase;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 24px; height: 24px;
      background: var(--accent); border-radius: 50%; margin-top: -11px; cursor: pointer;
    }
    #controlsWrapper {
      position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%);
      display: none; background: rgba(0,0,0,0.85); padding: 0.5rem; border: 1px solid var(--fg); z-index: 3;
    }
    .controls { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    #visualizer { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--bg); }
    #infoDisplay { position: absolute; top: 1rem; left: 1rem; background: rgba(0,0,0,0.6);
      padding: 0.5rem; white-space: pre; display: none; z-index: 3; }
    .footer { position: absolute; bottom: 0.5rem; width: 100%; text-align: center;
      font-size: 0.75rem; color: #888; }
  </style>
</head>
<body>
  <h1>PLANTASIA APP</h1>
  <div id="uiPanel">
    <button id="toggleUI">Show Controls</button>
    <button id="toggleData">Show Data</button>
    <button id="play">Play</button>
    <button id="stop">Stop</button>
  </div>
  <div id="controlsWrapper" class="controls">
    <label>Preset<select id="preset">
      <option value="plants">Plants</option>
      <option value="mold">Mold</option>
      <option value="bacteria">Bacteria</option>
      <option value="mushrooms">Mushrooms</option>
      <option value="harmony">Lifeform Harmony</option>
      <option value="dmt">DMT (Slow & Drowny)</option>
      <option value="planetRock">Planet Rock</option>
      <option value="bachPreludeC">Bach Prelude</option>
      <option value="euclid">Euclidean Rhythm</option>
      <option value="fib">Fibonacci Intervals</option>
      <option value="markov">Markov Chain</option>
      <option value="raga">Raga (Indian)</option>
      <option value="hijaz">Hijaz (Middle East)</option>
      <option value="pelog">Pelog (Gamelan)</option>
      <option value="insen">In-Sen (Japanese)</option>
    </select></label>
    <label>Freq <input type="range" id="freq" min="20" max="500" step="1" value="220"/></label>
    <label>Vol <input type="range" id="volume" min="0" max="100" step="1" value="40"/></label>
    <label>Density <input type="range" id="density" min="1" max="10" step="1" value="3"/></label>
  </div>
  <canvas id="visualizer"></canvas>
  <div id="infoDisplay"></div>
  <div class="footer">© 2025 Nate | Category: <span id="categoryLabel">Plants</span></div>
  <script>
    let audioCtx, analyser, dataTime, masterGain, bufferLen, osc, env;
    const canvas = document.getElementById("visualizer");
    const ctx = canvas.getContext("2d");

    const ctrls = {
      preset: document.getElementById("preset"),
      freq: document.getElementById("freq"),
      volume: document.getElementById("volume"),
      density: document.getElementById("density")
    };

    const ui = {
      play: document.getElementById("play"),
      stop: document.getElementById("stop"),
      toggleUI: document.getElementById("toggleUI"),
      toggleData: document.getElementById("toggleData"),
      controls: document.getElementById("controlsWrapper"),
      info: document.getElementById("infoDisplay"),
      category: document.getElementById("categoryLabel")
    };

    function resize() {
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    }

    function initAudio() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 1024;
      bufferLen = analyser.frequencyBinCount;
      dataTime = new Uint8Array(bufferLen);
      masterGain = audioCtx.createGain();
      masterGain.connect(audioCtx.destination);
      resize();
      window.addEventListener("resize", resize);
    }

    function playOscillator() {
      const now = audioCtx.currentTime;
      osc = audioCtx.createOscillator();
      osc.type = 'triangle';
      osc.frequency.value = parseFloat(ctrls.freq.value);

      env = audioCtx.createGain();
      env.gain.setValueAtTime(0, now);
      env.gain.linearRampToValueAtTime(1, now + 0.5);

      osc.connect(env).connect(analyser).connect(masterGain);
      masterGain.gain.value = parseFloat(ctrls.volume.value) / 100;
      osc.start();
    }

    function stopOscillator() {
      const now = audioCtx.currentTime;
      if (env && osc) {
        env.gain.cancelScheduledValues(now);
        env.gain.setValueAtTime(env.gain.gain.value, now);
        env.gain.linearRampToValueAtTime(0, now + 1);
        osc.stop(now + 1.1);
      }
    }

    function average(arr) {
      return arr.reduce((a, b) => a + b, 0) / arr.length;
    }

    function animate() {
      requestAnimationFrame(animate);
      if (!analyser) return;

      analyser.getByteTimeDomainData(dataTime);

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const low = average(dataTime.slice(0, bufferLen / 3)) / 255;
      const mid = average(dataTime.slice(bufferLen / 3, 2 * bufferLen / 3)) / 255;
      const high = average(dataTime.slice(2 * bufferLen / 3)) / 255;

      const size = Math.min(canvas.width, canvas.height) * 0.4;
      const h = size * Math.sqrt(3) / 2;
      const cx = canvas.width / 2, cy = canvas.height / 2;
      const verts = [[0, -h], [-size / 2, h / 3], [size / 2, h / 3]];
      const amps = [low, mid, high];

      ctx.beginPath();
      verts.forEach((v, i) => {
        const [dx, dy] = v;
        const r = 1 + amps[i] * 0.5;
        const x = cx + dx * r, y = cy + dy * r;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      });
      ctx.closePath();
      ctx.strokeStyle = "#00FF7F";
      ctx.lineWidth = 4;
      ctx.stroke();

      ctx.font = "12pt Roboto Mono";
      ctx.fillStyle = "#fff";
      ctx.textAlign = "center";
      ctx.fillText(ctrls.preset.options[ctrls.preset.selectedIndex].text, cx, 40);
    }

    ui.play.addEventListener("click", async () => {
      initAudio();
      if (audioCtx.state === "suspended") await audioCtx.resume();
      playOscillator();
    });

    ui.stop.addEventListener("click", () => {
      stopOscillator();
    });

    ui.toggleUI.addEventListener("click", () => {
      const showing = ui.controls.style.display === "flex";
      ui.controls.style.display = showing ? "none" : "flex";
      ui.toggleUI.textContent = showing ? "Show Controls" : "Hide Controls";
    });

    ui.toggleData.addEventListener("click", () => {
      const showing = ui.info.style.display === "block";
      ui.info.style.display = showing ? "none" : "block";
      ui.toggleData.textContent = showing ? "Show Data" : "Hide Data";
    });

    ctrls.preset.addEventListener("change", () => {
      ui.category.textContent = ctrls.preset.options[ctrls.preset.selectedIndex].text;
    });

    setInterval(() => {
      ui.info.textContent = `PRESET: ${ctrls.preset.value}\nFREQ: ${ctrls.freq.value}\nVOL: ${ctrls.volume.value}\nDENSITY: ${ctrls.density.value}`;
    }, 250);

    animate();
  </script>
</body>
</html>
